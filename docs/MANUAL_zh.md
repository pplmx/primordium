# Primordium 用户手册 (原初之境)

欢迎来到 **Primordium**。这是一个先进的人工生命模拟系统，实体在这里进化、形成社会，并在动态的生态系统中为生存而挣扎。本手册将指导您了解模拟机制和控制方法。

---

## 🚀 快速开始

### 运行模式

Primordium 在两种环境中运行：

1. **终端 (TUI)**：经典、高性能的文本界面体验。

   ```bash
   primordium
   ```

2. **Web 浏览器 (WASM)**：通过 WebAssembly 实现的现代图形界面。

---

## 🎮 控制指南

### 全局按键

| 按键 | 动作 |
| ----- | --------- |
| `q` | **退出** 模拟 |
| `Space` | **暂停/继续** 模拟 |
| `b` | 切换 **神经网络可视化** |
| `h` | 切换 **帮助/控制** 菜单 |
| `x` | 触发 **基因风暴** (全球大突变) |
| `u` | 切换 **音频** (程序化音效) |
| `{` / `}`| 音量减小 / 增大 |
| `m` | 手动诱发选中个体的 **突变** |
| `k` | 执行 **神罚** (抹除) 选中个体 |
| `p` | 诱发 **转生** (随机 DNA) 选中个体 |
| `Shift+K` | 切换 **全球热浪** 灾难 |
| `f` | 向选中谱系发送 **救济能量** |
| `l` | 触发 **大规模灭绝** (清除 90% 种群) |
| `r` | 触发 **资源爆发** (生成食物) |
| `w` | **保存** 世界状态到 `save.json` |
| `o` | **读取** 世界状态从 `save.json` |
| `c` | **导出 DNA** 选中个体到 `exported_dna.txt` |
| `C` | **导出大脑 JSON** 选中个体到 `logs/brain_<id>.json` |
| `v` | **注入 DNA** 从 `dna_infuse.txt` |
| `a` | 切换 **谱系视图** (家谱) |
| `Shift+A` | 导出完整谱系树为 DOT 文件 |
| `y` | 切换 **考古学与化石记录** |
| `[` / `]` | **时空旅行** (切换历史快照) |
| `+` / `-`| 加速 / 减速模拟 |
| `1 2 3 4 5` | **视图模式**: 标准、肥力、社会分区、等级 (P50)、声音 (P50) |
| `j` | 切换 **笔刷模式** (地形 / 社会) |
| `! @ #` | **社会笔刷**: 中立区、和平区、战争区 |
| `$ % ^` | **地形笔刷**: 绿洲、墙壁、荒地 |
| `Shift+1..5` | 切换帮助选项卡 (开启时) |

### 鼠标控制

| 输入 | 动作 |
| ----- | --------- |
| `左键拖拽` | 使用选中的笔刷 **绘画地形或社会区域** |
| `右键点击`| 在点击处注入食物簇 |

---

## 🖼️ 视图模式 (View Modes)

模拟器支持多种可视化模式，通过数字键 `1-5` 切换：

1. **标准视图 (Normal)**: 显示实体、食物和基础地形。
2. **肥力热图 (Fertility)**: 绿色深浅表示土地肥力，影响食物生长速度。
3. **社会分区 (Social Zones)**: 显示手动划分的中立区、和平区和战争区。
4. **等级热图 (Rank Heatmap)**: 可视化社会分层。紫红色梯度显示 Alpha 领导力强度。
5. **声音传播 (Vocal Propagation)**: 可视化声波。黄色波纹显示实时信号传播。

---



## 🔊 程序音频 (Phase 68 v2 & 68.6)

Primordium 采用纯 Rust 程序音频引擎，将模拟状态转化为沉浸式声景。

### 音频系统

- **熵合成**：由神经网络熵驱动的连续环境音景。低熵产生宁静的低鸣，高熵则创造混沌的调制。
- **生物音乐**：统治谱系的基因代码被翻译为独特的旋律序列。每个文明都会根据演化特征发展出独特的"声音"。
- **事件音效**：为出生、死亡、变态和气候事件生成的程序化音效。
- **空间定位 (Phase 68.6)**：出生和死亡事件具有真实的立体声定位。左右声像基于实体相对于世界中心的 X 位置，距离衰减会抑制远端事件。

### 工作原理

1. **数据采集**：每个 tick 追踪：
   - 平均脑熵（所有实体的神经网络熵值）
   - 生物总量
   - 统治谱系的基因型
   - 事件位置（x, y 坐标）

2. **合成**：
   - **熵合成器**：使用 FM 合成，调制指数由生物总量驱动，载波频率随熵值变化。
   - **生物音乐**：将基因组十六进制值映射为音符、节奏和音阶。
   - **空间音频**：计算立体声声像（每声道 0.0-1.0）并应用基于距离的衰减（逆平方定律）。

3. **混音**：所有音源按适当的增益级混合：
   - 熵合成器：30% 音量（环境音）
   - 生物音乐：50% 音量（旋律）
   - 事件音效：80% 音量（前景音效）

### 空间听觉

- **出生事件**：实体出生时，您会听到基于其 X 位置独特的声音（左/右声像）。
- **死亡事件**：实体死亡会触发悲伤的音调，具有定位和距离衰减效果。
- **居中双声道**：气候变化、纪元转换和环境转换在左右声道以相等音量播放。

## 👁️ 界面指南

### 实体与状态

实体由符号表示，指示其当前生理状态：

- `●` **觅食**：标准状态，正在寻找资源。
- `♦` **狩猎**：攻击状态，试图捕食其他实体。
- `♥` **交配**：高能量状态，准备繁殖。
- `†` **饥饿**：危急能量状态 (< 20%)，死亡风险极高。
- `♣` **分享**：利他状态，向附近的部落成员提供能量。
- `☣` **感染**：携带病原体，会持续损耗能量。
- `◦` **幼体**：尚未发育成熟，无法进行繁殖。
- `⚔` **士兵**：高等级的攻击型防御者。造成 1.5 倍伤害。

### 特化阶级 (Specialized Castes - Phase 53)

实体可根据其行为演化出专门角色：

- **士兵 (Soldier)**: 高伤害 (1.5x)。具有更高的基础代谢。
- **工程师 (Engineer)**: 地形改造专家。挖掘 (Dig) 与建造 (Build) 的能量消耗降低 50%。
- **供给者 (Provider)**: 利他分享者。分享能量时自身的额外代谢惩罚降低 50%。

### 士兵与领袖光环 (Soldier & Alpha Auras)

- **Alpha 领袖**: 拥有最高等级的成员会产生领导力场，吸引或引导周围部落成员的移动。
- **士兵光环**: 士兵在战斗时会显示特殊标识，并为周围较弱的成员提供防御加成。

### 颜色 (部落)

实体根据其 **基因部落** 显示颜色。

- 颜色相近的实体属于同一个 **部落**。
- 部落成员 **不** 会互相攻击。
- 部落成员可能会分享能量。

### 地形与演替

- ` ` **平原**：标准移动速度。
- `≈` **河流** (蓝色)：移动速度更快 (1.5x)。
- `▲` **山脉** (灰色)：移动缓慢 (0.5x)，无食物生长。
- `◊` **绿洲** (青绿色)：食物生成率 3x。
- `♠` **森林** (深绿色)：碳封存汇，高食物产量 (2x)。高肥力、高植物生物量时平原会演替为森林。
- `▒` **沙漠** (沙黄色)：贫瘠且具有高热压力。低肥力时平原会退化为沙漠。
- `░` **荒芜** (棕色)：过度放牧后的土地，食物极少。
- `█` **墙壁** (深灰色)：不可逾越的物理障碍。
- `Ψ` **前哨站**: 由阿尔法建立的文明结构。作为能量电容器和信息素中继站。
- `Ω` **巢穴** (金色)：实体建造的保护性结构。提供代谢恢复加成和后代发育能量红利。
- `*` **食物** (绿色)：能量源。

---

## 🧬 进化机制

### 大脑 (循环神经网络)

每个实体都拥有一个代代进化的 **循环神经网络** (RNN-lite)。

- **输入 (传感器)**:
    - 环境输入 (视觉、能量、信息素、密度)
    - **记忆输入**: 6个输入端用于保留上一时刻的内部状态。
- **输出 (动作)**:
    - 移动、爆发、攻击、分享、信号。

### 遗传与适应

通过遗传算法产生后代，混合父母的 DNA 并发生轻微突变。

- **属性**: 速度、感知范围、代谢生态位、性选择偏好。
- **大脑**: 拓扑结构与权重均会发生突变。
- **人口感知突变**:
    - **瓶颈效应**: 人口稀少时，突变率提升 (最高3倍) 以寻找生存出路。
    - **演化停滞**: 大规模稳定种群中，突变率减半以维持优良基因。
- **遗传漂变**: 极小种群 (<10) 可能会发生随机的大幅性状翻转。

### 社会等级 (Phase 49)

部落现在基于 **等级 (Rank)** 分数（能量+年龄+后代+声誉）进行组织。

- **阿尔法领导力**: 实体的移动会受到当地最高等级成员（Alpha）的影响。Alpha 还可以通过 **动态领地 (Dynamic Territoriality)** 自动宣称和平区或战争区。
- **士兵阶层**: 高等级 (>0.8) 且高攻击性 (>0.5) 的实体会转职为士兵。它们是部落的主要防御力量。
- **部落分裂**: 如果低等级实体 (Omega) 被困在过度拥挤的区域，可能会触发 **断裂 (Fracture)**，改变颜色并建立一个新的敌对部落以逃避竞争压力。

### 社会笔刷 (Social Brushes)

您可以使用社会笔刷手动定义区域规则（按 `j` 切换模式）：

- **中立区 (Neutral)**: 默认区域，无特殊社会限制。
- **和平区 (Peace Zone)**: 强制非攻击区域。实体在此区域内通常会停止互相攻击。
- **战争区 (War Zone)**: 冲突高发区域。士兵在此区域内造成 **2.0 倍** 伤害。

---

## 🌍 生态系统

### 考古学与化石记录 (Phase 40)

Primordium 通过两种核心机制保留世界的深层历史：

- **历史快照 (History Snapshots)**：每 1,000 tick，系统会捕获一次世界的宏观状态（人口、碳排放、多样性热点）。使用考古学视图 (`y`) 和时空旅行键 (`[`/`]`) 即可浏览这些快照。
- **化石记录 (Fossil Record)**：当一个具有“传奇”地位的谱系灭绝时，其遗传遗产和大脑架构会被“化石化”并存入持久化注册表 (`logs/fossils.json`)。您可以在考古学面板中查看这些先祖图标。

### 碳循环与大气化学 (Carbon Cycle & Atmospheric Chemistry - Phase 56)

模拟系统包含全球性的 **碳与氧循环**:

- **CO2 (碳水平)**: 所有实体的代谢活动会增加大气 CO2 水平。高 CO2 会引发全球变暖。
- **O2 (氧水平)**: 植物生物量和森林通过光合作用产生氧气。
- **代谢耦合**: 实体会消耗氧气。高氧环境提升移动效率；低氧 (< 8%) 会引发缺氧压力 (额外能量损耗)。
- **全球变暖**: 高 CO2 水平会将气候推向 **酷热 (Scorching)** 状态，增加所有生命的代谢压力。

### 天气与循环

- **昼夜循环**：世界在白昼与黑夜间交替。
    - **白昼**：高光照强度驱动食物生长。
    - **黑夜**：实体进入“休息”状态，代谢降低 40%。

### 病原体与寄生操控 (Phase 55)

微观威胁会涌现并传播：

- **传染性**: 疾病通过邻近接触传播。
- **行为劫持**: 寄生型病原体会强制偏移宿主的神经输出（如强制攻击、强制发声），以协助自身的扩散。
- **进化**: 在感染中幸存会提升 `免疫力 (Immunity)`。

### 灾难 (Disasters)

- **沙尘暴 (Dust Bowl)**：热浪期间且种群密集时触发，导致平原荒芜化，损耗土地肥力。

---

## ⚔️ 游戏模式 (Game Modes)

使用 `--gamemode` 参数启动：`standard` (标准), `coop` (合作), `battle` (大逃杀)。

---

## 🌌 多人联机与网络

Primordium 支持 **全球蜂巢式迁移 (Global Hive Migration)**。实体可以通过中央中继服务器在不同用户的模拟实例之间进行跨界迁移。

### 中继服务器

- **默认端口**: `3000`
- 中继服务器负责将迁移的实体广播给所有已连接的对等端。

### 如何迁移

1. 确保您的模拟程序已连接到中继服务器。
2. 当实体 **移动到世界边缘之外** 时，即会触发迁移。
3. 它将从您的屏幕上消失，并出现在另一位用户的宇宙中。

---

## 📚 技术维基 (Technical Wiki)

- [遗传学与 HexDNA](../docs/wiki/GENETICS.md)
- [神经网络架构](../docs/wiki/BRAIN.md)
- [生态系统公式](../docs/wiki/ECOSYSTEM.md)
- [历史与考古学](../docs/wiki/HISTORY.md)

---
*更新时间: 2026-01-27*
