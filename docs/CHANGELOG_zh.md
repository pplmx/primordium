# 修订历史 - Primordium (原初之境)

[English](../CHANGELOG.md)

本文件记录了 **Primordium** 项目的所有重大变更。本项目遵循基于阶段的演进式开发周期。

---

## [阶段 49: 高级社会等级 (部落战争) (Advanced Social Hierarchies - Tribal Warfare)] - 2026-01-24

### 演进飞跃：领袖与军队的崛起

阶段 49 引入了复杂的社会分层。部落不再是平等的群体；它们现在拥有阿尔法（领袖）和士兵阶层。当人口压力破坏社会凝聚力时，大型部落将分裂为相互竞争的派系，模拟内战和分裂。

#### ✨ 功能特性

- **社会等级系统**: 实体现在拥有基于能量 (30%)、年龄 (30%)、后代 (10%) 和声誉 (30%) 计算得出的 `rank` (0.0-1.0)。
- **士兵阶层 (Soldier Caste)**: 高等级 (>0.8) 且具有攻击性 (>0.5) 的实体将成为 **士兵** (`⚔`)。它们造成的伤害通常提高 **1.5倍**，在战区中提高 **2.0倍**。
- **部落分裂**: 过度拥挤加上低社会等级会触发“断裂”事件，边缘群体会突变其颜色以形成新的敌对部落。
- **领导力向量**: 实体现在可以感知并受到当地阿尔法（最高等级亲属）移动的影响。

#### 🛠️ 技术成就

- **等级与领导力引擎**: 在 `world.rs` 第 1 遍中实现了 `calculate_social_rank` 和阿尔法加权移动向量。
- **动态状态逻辑**: 重构了 `EntityStatus`，优先考虑基于角色的状态（士兵）而非行为状态（狩猎）。
- **大脑架构修复**: 修正了神经网络输出层中的关键“差一错误”（节点 20 vs 21），确保动作映射正确。

---

## [阶段 51: 共生系统 (Symbiosis) - 伴侣意识与结伴机制] - 2026-01-24

### 演进飞跃：伴侣意识与互惠合作

阶段 51 引入了共生系统，使实体能够建立持久的伙伴关系。通过神经网络的扩展，实体现在可以感知伙伴的能量状态并主动发起结伴请求，实现互惠的能量共享和协同行为。

#### ✨ 功能特性

- **大脑索引修复**: 解决了关键的结构错误——Input 20（听觉）与 Output 20（移动X）的索引重叠。将输出层移至 22..31，确保正确的动作映射。
- **伙伴能量感知**: 新增节点 21 作为伙伴能量输入，使实体能够实时感知绑定伙伴的能量水平，实现基于需求的互惠支持。
- **主动结伴输出**: 新增节点 30 作为结伴输出，允许实体通过神经决策主动发起结伴请求，而非仅仅被动响应。
- **共生处理引擎**: 在 `Social` 系统中实现 `handle_symbiosis` 函数，支持基于遗传相似度和配对偏好的选择性结伴。
- **互惠能量共享**: 实现 bonded 伙伴之间的代谢互助机制。当伙伴能量不足时，高能量实体会自动分享能量，强化共生关系。
- **TUI 可视化增强**: 添加 bonded 状态符号（⚭）和金色光环，使共生关系在视觉上立即可辨。

#### 🛠️ 技术成就

- **大脑架构重构**: 将标准神经网络架构扩展为 22 输入（14 传感器 + 6 记忆 + 1 听觉 + 1 伙伴能量）→ 6 隐藏 → 9 输出（+1 结伴输出）。
- **并行命令模式扩展**: 在 3 遍并行更新循环中添加 `Bond` 命令，实现线程安全的结伴操作。
- **拓扑一致性修复**: 更新 AGENTS.md、BRAIN.md 和所有测试用例以反映修正后的索引结构。
- **向后兼容性**: 保持旧版 `last_share_intent` 检查逻辑，支持遗留测试和现有行为模式。

---

## [阶段 50: 可视化不可见 (集体智能) (Visualizing the Invisible - Collective Intelligence)] - 2026-01-24

### 演进飞跃：抽象的感知

阶段 50 改变了模拟的可观测性。前几个阶段引入的复杂内部状态——社会等级、声音信号和领土主张——现在通过多层热力图系统呈现。实体不再在黑暗中"听"或"感知"等级；模拟现在可视化集体智能和动态主权的涌现。

#### ✨ 功能特性

- **等级热力图 (视图 4)**: 实时可视化社会分层。紫色/洋红色渐变显示部落如何围绕阿尔法组织，以及低等级实体如何被边缘化。
- **声音传播 (视图 5)**: 黄色"声波"可视化信号密度。观察警报呼叫和协调信号如何在种群中传播，从噪声走向意义。
- **士兵与阿尔法光环**: 高影响力个体（士兵/阿尔法）现在在社交视图中拥有视觉"光环"，使领导和防御结构立即可见。
- **动态领土性**: 部落现在积极"声称"领土。阿尔法实体根据其攻击性自动将局部社交网格翻转至"和平"（对同族）或"战争"（对敌对），创造涌现的边界。
- **集体强化**: 增强的 Hebbian 学习循环，奖励社交接近和声音协调，加速复杂群体行为的演化。

#### 🛠️ 技术成就

- **空间热力图引擎**: 在 `WorldWidget` 中实现高性能空间查询，实时渲染抽象信号（声音、等级密度）的传播。
- **动态社交网格逻辑**: 将 `TribalTerritory` 命令集成到 3 遍并行更新循环中，允许阿尔法动态引导区域规则。
- **声音输出标准化**: 标准化神经输出的声音强度，使输入 14（听觉）能够携带一致的语义音量。
- **遗留重构**: 标记并废弃顺序社交系统，确保 100% 的社交交互逻辑使用线程安全的并行命令模式。

---

## [阶段 34: 生命之树 (谱系可视化) (The Tree of Life - Ancestry Visualization)] - 2026-01-23

### 演进飞跃：宏观演化图谱与王朝分析

阶段 34 引入了由 `petgraph` 驱动的高级谱系追踪系统。模拟现在不再仅仅追踪当前的种群数量，而是构建一棵持久的“生命之树”，可视化从第一颗种子到当前优势王朝的演化路径。

#### ✨ 功能特性

- **实时谱系树**: 在专门的 TUI 视图中可视化谱系间的演化关系（按 `A` 键）。
- **Graphviz/DOT 导出**: 将世界的完整演化史导出为 `.dot` 文件，以便进行外部可视化分析（按 `Shift+A` 键）。
- **优势王朝追踪**: 自动识别并高亮显示当前最成功的 5 个演化分支。
- **谱系-营养级叠加**: 谱系视图整合了营养级数据，展示了食性特化（食草/食肉）是如何沿家族树演化出来的。

#### 🛠️ 技术成就

- **基于图的谱系注册表**: 使用 `petgraph` 实现了 `lineage_tree.rs`，将宏观演化数据作为有向图进行管理。
- **动态分支检测**: 开发了用于检测显著谱系分化并记录分支事件的算法。
- **高性能 TUI 树渲染**: 定制渲染逻辑，在终端限制下展示复杂的图结构。

---

## [阶段 32.5: 质量锁定与系统硬化 (Quality Lockdown & Hardening)] - 2026-01-23

### 稳定性飞跃：零崩溃与系统完整性

阶段 32.5 标志着从功能爆发向生产级硬化的过渡。核心引擎及其 15+ 集成测试套件已与 19x8 神经架构和生活史基因完全同步。

#### ✨ 功能特性

- **引擎硬化**: 实现了跨宇宙迁移和 DNA 注入的零崩溃保证，能够成功处理畸形或版本不匹配的数据。
- **健壮性测试集**: 新增 `tests/robustness.rs` 以验证大灭绝、受损遗传载荷等边缘情况。
- **ActionContext 设计模式**: 重构了动力系统以使用统一的上下文，解决了技术债务并提升了高并发循环下的性能。

#### 🛠️ 技术成就

- **系统同步**: 修复并更新了所有遗留的集成测试（生态、社交、病原体、灾难），以支持阶段 32 的多基因生态系统。
- **生物力学修正**: 纠正了惯性缩放逻辑，现在较大的能量存储会正确增加质量并降低转向灵敏度。
- **Clippy 零警告基准**: 在严格的 `-D warnings` 门禁下实现了整个工作区的零警告状态。

---

## [阶段 32: 生活史策略 (R/K 选择) (Life History Strategies - R/K Selection)] - 2026-01-23

### 演进飞跃：成熟率与亲代投入

阶段 32 引入了生物生活史策略，允许生物进化其繁殖和发育模式。谱系现在可以特化为“R-策略者”（快速产生大量低投入后代）或“K-策略者”（重金投入少量高质量后代）。

#### ✨ 功能特性

- **生活史基因 (Life History Genes)**: 在基因型中增加了 `reproductive_investment` (0.1-0.9) 和 `maturity_gene` (0.5-2.0)。
- **R/K 选择机制**: 生物现在可以进化传递给后代的能量比例以及达到成熟所需的时间。
- **生长-体型耦合**: 实体的 `max_energy`（胃部大小）现在随其 `maturity_gene` 缩放，在快速世代更替与个体韧性之间创建了权衡。
- **发育动量 (Developmental Momentum)**: 具有高成熟基因的特化个体在生命开始时拥有显著更高的能量储备，但面临更长的幼年期。

#### 🛠️ 技术成就

- **遗传策略引擎**: 更新了繁殖系统，将可进化的投入比例纳入考虑。
- **动态成熟门禁**: 重构了 `Biological` 系统，以处理每个实体变量化的成熟阈值。
- **HexDNA 更新**: 扩展了序列化协议，以包含生活史基因。

---

## [阶段 31: 代谢生态位与资源多样性 (Metabolic Niches & Resource Diversity)] - 2026-01-23

### 演进飞跃：饮食特化与类型化资源

阶段 31 引入了资源多样性和代谢特化。食物来源现在带有特定的营养类型（绿色 vs. 蓝色），生物必须进化出匹配的代谢生态位才能高效消化它们。这产生了强烈的基于地形的特化选择压力，因为不同的生物群落现在倾向于不同的营养类型。

#### ✨ 功能特性

- **代谢生态位 (Metabolic Niches)**: 生物现在拥有遗传性的 `metabolic_niche` 特征，决定了其对不同食物类型的消化效率。
- **资源多样性**: 食物项现在具有 `nutrient_type` 属性（0.0 代表绿色，1.0 代表蓝色）。
- **消化效率引擎**: 实现了缩放系统，专业匹配可获得 **1.2x** 能量收益，而完全不匹配仅获得 **0.2x**。
- **地形-营养耦合**: 山脉和河流现在主要生成蓝色食物，而平原和绿洲生成绿色食物。
- **营养感知**: 增加了第 12 个环境大脑输入 (`NutType`)，允许生物感知最近食物源的营养类型。

#### 🛠️ 技术成就

- **扩展大脑拓扑**: 将标准架构升级为 **19-6-8 RNN-lite** 以支持营养感知。
- **类型化资源生成**: 增强了 `Ecological` 系统，在食物生成过程中考虑地形类型。
- **基因型扩展**: 将 `metabolic_niche` 整合到可继承的基因型和 HexDNA 协议中。

---

## [阶段 30: 社交协同与亲缘识别 (Social Coordination & Kin Recognition)] - 2026-01-23

### 演进飞跃：集群行为与语义通信

阶段 30 通过亲缘识别和主动语义信号引入了高级社交行为。生物现在可以感知其谱系的相对质心，从而通过扩展后的神经架构实现集体运动模式和集群行为的涌现。

#### ✨ 功能特性

- **亲缘质心感知 (KX, KY)**: 生物现在可以将同谱系盟友的相对位置作为一个统一的向量进行感知，从而实现群体凝聚力。
- **集群加成 (Herding Bonus)**: 实现了代谢奖励（每 tick 0.05 能量），奖励与亲缘质心保持一致方向移动的行为，鼓励集体迁徙。
- **语义信息素 (Signal A/B)**: 增加了抽象信号的神经输出和环境传感器，为进化的协同行为提供了基础。
- **增强的神经基质**: 将标准大脑架构升级为 **18-6-8 RNN-lite**，以支持新的社交输入和动作输出。
- **年龄与墙壁感知**: 增加了专门用于成熟度 (`AG`) 和墙壁邻近度 (`WL`) 的传感器，以实现更好的环境适应。

#### 🛠️ 技术成就

- **扩展大脑拓扑**: 将环境输入从 7 个增加到 12 个，输出从 6 个增加到 8 个。
- **亲缘向量引擎**: 在 `Social` 系统中实现了谱系质心的实时计算。
- **速度调节**: 输出 2 现在控制连续的速度调节，而非二元的加速（Boost）。

---

## [阶段 28: 复杂大脑演化 (Complex Brain Evolution - NEAT-lite)] - 2026-01-23

### 演进飞跃：可进化的拓扑结构与效率压力

阶段 28 将认知引擎从固定矩阵的 MLP 转换为动态的、基于图结构的 **NEAT-lite** 架构。大脑不再是静态的；它们可以通过变异产生新的神经元和连接，从而实现更专业、更复杂的行为，同时对不必要的复杂性实施代谢惩罚。

#### ✨ 功能特性

- **可进化的拓扑结构**: 实现了“增加节点”和“增加连接”的变异，使大脑能够跨代增长复杂性。
- **创新追踪 (Innovation Tracking)**: 通过创新号追踪结构变异，确保不同拓扑结构之间能够进行一致的基因交叉。
- **冗余代谢惩罚**: 引入了大脑复杂性的能量成本（每个节点 0.02，每个连接 0.005），以筛选出认知效率高的个体。
- **动态大脑可视化**: TUI 大脑热图现在可以适应并显示演化中的图结构和连接权重。

#### 🛠️ 技术成就

- **基于图的神经引擎**: 将 `Brain` 从基于矩阵的结构重构为邻接表图结构，以实现灵活的推理。
- **NEAT 交叉算法**: 为结构基因实现了基于创新号对齐的交叉机制。
- **代谢复杂性缩放**: 将结构成本整合到 `Action` 系统的能量消耗公式中。

---

## [阶段 25: 社交复杂性与防御演化 (Social Complexity & Defense Evolution)] - 2026-01-23

### 演进飞跃：集体智能与动态信号

阶段 25 引入了更深层次的社交动力学，重点在于相互保护和主动通信。谱系现在拥有了涌现出的“自我”与“他者”意识，实现了群体防御策略和实时的视觉信号。

#### ✨ 功能特性

- **谱系感知**: 神经网络现在可以接收附近同谱系成员密度的实时数据。
- **群体防御机制**: 引入了“社交防御”加成。当实体被同谱系盟友包围时，受到的伤害会显著降低（最高可降低 60%）。
- **动态颜色信号**: 生物现在可以通过专门的神经输出来调节其颜色强度，从而实现警告显示或隐身行为。
- **谱系密度输入**: 在大脑中增加了第 13 个输入项 `LineageDensity`，使生物能够对亲缘的存在做出反应。

#### 🛠️ 技术成就

- **扩展大脑拓扑**: 将标准架构升级为 **13-6-6 RNN-lite**，以支持新的社交输入和信号输出。
- **社交防御引擎**: 在 `Social` 系统中实现了基于邻近度的伤害乘数 ($M_{defense}$)。
- **信号代谢成本**: 将信号强度整合到代谢消耗公式中，每单位主动调节增加 **0.1 能量** 消耗。

---

## [阶段 24: 谱系与宏观演化 (Lineage & Macroevolution)] - 2026-01-23

### 演进飞跃：祖先追踪与王朝霸权

阶段 24 将关注点从个体生存转向祖先谱系的长期成功。通过引入正式的谱系追踪，模拟现在可以可视化特定“王朝”在数代之间、甚至在不同模拟宇宙之间的兴衰。

#### ✨ 功能特性

- **谱系追踪 (Lineage Tracking)**: 每个生物现在都被分配了一个永久的 `lineage_id`，从其祖先处继承。
- **王朝统治可视化**: TUI 现在可以显示最成功的谱系，展示哪些祖先品系目前正统治着生态系统。
- **跨宇宙祖先保存**: 在跨宇宙迁移过程中保留谱系数据，让您的“优势族群”即使在异域模拟中也能保持其身份。
- **宏观演化统计**: 新增对谱系多样性、特定品系灭绝率和祖先长寿度的统计追踪。

---

## [阶段 23: 表型特化 (Phenotypic Specialization)] - 2026-01-23

### 演进飞跃：物理多样性与生存权衡

生物不再是物理上完全相同的个体。演化现在同时作用于物理特征（表型）和神经智能，创造了一个更多元化、更具专业性的生态系统。

#### ✨ 功能特性

- **统一基因型 (Unified Genotype)**: 将物理特征直接整合到基因序列中。所有属性现在都是可变、可遗传的，并受自然选择影响。
- **可变感知半径**: 生物可以进化出 3.0 到 15.0 单位之间的感知半径。
- **可变最大速度**: 移动能力范围扩展至每 tick 0.5 到 3.0 单位。
- **可变能量上限**: 能量存储容量（胃部大小）现在是一个可进化特征 (100-500)。

#### 🛠️ 技术成就

- **表型权衡引擎**: 实现了动态代谢缩放。优越的特征现在伴随着沉重的代价：
    - 感知：+0.1 半径 -> +2% 静息消耗。
    - 速度：+0.1 速度 -> +5% 移动消耗。
- **生物力学惯性**: 引入了质量-响应模型，更高的能量容量会降低加速度（转向响应性）。
- **遗传同步优化**: 优化了繁殖系统，确保表型基因在基因型 (Genotype) 与组件 (Component) 状态之间正确同步。

---

## [阶段 22: 并行演化与全球蜂巢 (Parallel Evolution & Global Hive)] - 2026-01-23

### 演进飞跃：分布式智能与多重宇宙

模拟已经超越了单机限制，允许生物在全球网络中迁移，并在共享的数字“蜂巢”中共同演化。

#### ✨ 功能特性

- **全球蜂巢迁移**: 触碰世界边界的实体现在可以被序列化，并通过中央中继站传输到其他连接的模拟实例。
- **中继服务器架构**: 基于 **Axum** 构建的新型高性能中继服务器，用于管理跨多重宇宙的生命分配。
- **RESTful 监控**: 实时 API 接口，用于检查全球模拟健康状况、对等节点数和迁移流量。
- **P2P 发现机制**: 在全球蜂巢内实现自动化的对等节点宣告与列表维护。

#### 🛠️ 技术成就

- **异步网络**: 实现了基于 WebSocket 的非阻塞协议，用于实时的实体传输。
- **安全锚定**: 将基于比特币的历史验证集成到网络堆栈中，确保迁入生物的真实性。
- **增强型网络测试**: 覆盖了实体序列化、WebSocket 握手和广播逻辑的全面集成测试。

---

## [阶段 21: 环境流动性与灾难 (Environmental Fluidity & Disasters)] - 2026-01-21

### 演进飞跃：时间连贯性与动态危机

数字生态系统获得了“记忆”并面临首次环境大灾难，这要求生物进化出更复杂的生存策略。

#### ✨ 功能特性

- **循环神经网络 (RNN-lite)**: 升级了大脑架构，引入上一个 tick 隐藏层的反馈回路，实现了时间连贯的行为和内部记忆。
- **沙尘暴灾难 (Dust Bowl)**: 引入了动态地形事件。当种群压力过大且处于热浪时，会触发大规模土地肥力损耗和荒芜化。
- **物理障碍**: 增加了不可穿透的 `Wall` (墙壁/岩石) 地形，迫使生物进化出转向和避障能力。
- **局部感知**: 从全局食物知识迁移到真实的“感知半径”（20单位），由专门的 `food_hash` 提供动力。

#### 🛠️ 技术成就

- **O(1) 感知**: 集成了第二个空间哈希 (Spatial Hash) 专门用于资源管理，降低了感官查询复杂度。
- **缓冲池 (Buffer Pooling)**: 在 `World` 结构体中实现了可重用的堆分配，显著降低了并行执行时的内存分配开销。
- **有状态智能**: 在 `Intel` 组件中增加了持久化的 `last_hidden` 状态，支持新的循环大脑架构。
- **物理引擎升级**: 增强了 `handle_movement` 逻辑，支持对不可通行地形的碰撞检测与反弹。
- **自动化验证**: 新增 `tests/disasters.rs` 覆盖了灾难触发与物理碰撞逻辑。

---

## [阶段 20: 认知合成与系统重构 (Cognitive Synthesis & Systemic Refactor)] - 2026-01-21

### 演进飞跃：基于组件的生命与并行智能

模拟经历了自项目启动以来最重大的架构演进，转向了专为极致性能和超大规模扩展设计的模块化组件系统。

#### ✨ 功能特性

- **基于组件的实体 (CBE)**: 生物属性现已逻辑分组为物理 (Physics)、代谢 (Metabolism)、健康 (Health) 和智力 (Intel) 组件，提升了系统隔离度和数据局部性。
- **系统化解耦**: 世界更新循环被拆分为一系列专业化的“系统”（感知、行动、生物、社交），使逻辑更易于扩展和维护。
- **Rayon 驱动的并行化**: 集成了 Rayon 数据并行库，利用多核 CPU 处理沉重的计算任务。
- **高密度扩展**: 针对 5000+ 同时存在的实体进行了优化，支持多线程神经推理。

#### 🛠️ 技术成就

- **并行大脑推理**: 神经网络前向传播现已通过 `.par_iter()` 实现并行处理。
- **系统流水线**: 将 `World::update` 重构为离散阶段，解决了长期存在的“单体代码”技术债务。
- **数据局部性**: 组件分组使模拟每系统仅处理相关数据子集，减少了缓存失效。
- **逻辑等效性**: 在大幅提升吞吐量的同时，实现了与之前版本 100% 的功能等效。

---

## [阶段 19: 昼夜循环 (Circadian Rhythms)] - 2026-01-21

### 演进飞跃：时间维度的引入

数字生态系统现在随昼夜周期波动，影响植物生长及生物的新陈代谢。

#### ✨ 功能特性

- **昼夜周期**: 引入全球时钟（默认 2000 刻），实现白昼与黑夜的交替。
- **光照依赖生长**: 食物生成概率与当前光照强度 (`light_level`) 挂钩。正午生长最快，黑夜几乎停滞。
- **休息代谢**: 生物在夜间进入低功耗模式，静息能量消耗降低 40%。
- **TUI 可视化**: 状态栏实时显示昼夜图标 (☀️/🌙) 及当前时钟进度。

#### 🛠️ 技术成就

- **环境状态推进**: 在世界更新循环中集成了 `Environment::tick` 机制。
- **物理耦合**: 将光照强度和昼夜系数整合进核心代谢算法中。
- **验证**: 新增 `test_light_dependent_food_growth` 集成测试验证光照对生态的影响。

---

## [阶段 15-18: 生物学、生态与病原体] - 2026-01-21

### 演进飞跃：完善的生命链与免疫演化

数字生态系统已进化为一个具有深度防御与发育机制的复杂网络，引入了病原体威胁、生命周期管理及食性特化。

#### ✨ 功能特性

- **阶段 15: 生命周期 (Life Cycles)**：
    - **幼体状态 (◦)**：实体必须存活 150 刻才能成年。
    - **发育门禁**：幼体无法繁殖。
- **阶段 16: 营养级 (Trophic Levels)**：
    - **食性分化**：分为食草 (H-) 和食肉 (C-) 角色。
    - **收益博弈**：食肉动物捕食收益更高，但无法以植物为食。
- **阶段 17: 生态演替 (Ecological Succession)**：
    - **土地肥力**：采食会消耗地块肥力，低肥力地块变为“荒芜 (░)”。
    - **动态恢复**：肥力随时间再生，驱动种群迁徙。
- **阶段 18: 病原体与免疫 (Pathogens & Immunity)**：
    - **传染病模拟**：病原体可在实体间邻近传播。
    - **免疫进化**：实体在康复后提升免疫力，并将抗性遗传给下一代。
    - **环境爆发**：随机产生的环境病原体增加长期生存挑战。

#### 🛠️ 技术成就

- **系统重构**: 优化了 `World::update` 中的空间哈希处理逻辑，支持跨实体的复杂感知与传染判定。
- **分层验证**: 新增 `tests/ecology.rs` 和 `tests/pathogens.rs`，实现了 100% 的关键逻辑覆盖。
- **视觉反馈**: TUI 界面新增感染 (☣) 符号及动态颜色标识。

---

## [阶段 14: 游戏性与打磨 (Gameplay & Polish)] - 2026-01-21

### 演进飞跃：分歧的现实与数字稳定性

模拟现在支持不同的游戏模式，并经过大规模架构重构和全方位质量门禁，达到了巅峰稳定性。

#### ✨ 新特性

- **游戏模式**：
    - **合作模式 (`--gamemode coop`)**：强制全球和平；适合聚落生长。
    - **大逃杀模式 (`--gamemode battle`)**：收缩的世界边界迫使冲突发生。
- **增强型 TUI**:
    - **图例栏 (Legend Bar)**: 新增第四行状态栏，实时对照实体状态与地形符号。
    - **帮助系统**: 新增四页式标签化帮助菜单（控制、符号、概念、纪元）。
    - **新手引导**: 为初次进入模拟的“神明”提供 3 页式基础教程。
- **文档**：
    - 全面的 **用户手册** (双语)。
    - **技术维基** 涵盖遗传学、大脑和生态系统。
    - **智能体记忆**: 新增 `AGENTS.md` 辅助 AI 协作开发。

#### 🛠️ 技术成就

- **模块化重构**: 将 870 行的单体文件 `app.rs` 彻底拆分为 `src/app/` 下的清晰模块结构。
- **质量门禁**: 建立了基于 Husky 的严格提交前流水线（格式化、类型检查、Clippy、全量测试）。
- **全面测试**: 新增 30+ 测试用例，覆盖核心逻辑（大脑、实体、空间索引）及集成流（生命周期、DNA 协议、纪元切换）。
- **性能优化**:
    - 为发布版本启用了 **LTO** (链接时优化)。
    - 使用优化后的迭代器和空间哈希取代了 $O(N^2)$ 性能瓶颈。
- **鲁棒性**: 实现 100% Clippy规范化，并自动管理日志目录生命周期。

---

## [阶段 13: 多人联机 (Multiplayer)] - 2026-01-21

### 进化跃迁：星际移民

Primordium 现在支持分布式模拟，实体可以通过中继服务器在不同用户的“宇宙”之间迁移。

#### ✨ 新特性

- **中继服务器**：基于 `axum` 和 WebSockets 的新 `primordium-server` 二进制文件，用于路由流量。
- **客户端网络**：WASM 客户端可连接中继服务器并发送/接收实体。
- **跨界迁移**：触碰世界边缘的实体会被序列化并发送给其他已连接的客户端。
- **实时可视化**：Web UI 显示连接状态 and 网络事件。

#### 🛠️ 技术成就

- **WebSocket 协议**：用于握手和实体传输的自定义 JSON 协议。
- **多箱 (Multi-Crate) 工作区**：项目结构更新以支持 `bin` (服务器) 和 `lib/wasm` (客户端) 目标。
- **实体序列化**：DNA 和统计数据在网络传输期间得以保留。

---

## [阶段 12: WebAssembly 移植 (WebAssembly Port)] - 2026-01-21

### 进化跃迁：打破终端壁垒

Primordium 现在可以通过 WebAssembly 和 HTML5 Canvas 在现代网络浏览器中运行。

#### ✨ 新特性

- **WASM 支持**：核心模拟通过 `wasm-pack` 编译为 WebAssembly。
- **Canvas 渲染**：新增 `WebRenderer` 替代 TUI，实现 60 FPS 浏览器可视化。
- **Web 界面**：具有实时统计和控制功能的现代“玻璃拟态 (Glassmorphism)” UI。
- **双目标支持**：项目同时支持原生 CLI (TUI) 和 Web (Canvas) 构建。

#### 🛠️ 技术成就

- **库重构**：将核心逻辑提取到 `lib.rs` 以支持 dual 目标。
- **条件编译**：使用 `#[cfg(target_arch = "wasm32")]` 保持原生兼容性.
- **JS 互操作**：通过 `wasm-bindgen` 将 `Simulation` 结构体和 `draw` 方法暴露给 JavaScript。

---

## [阶段 11: 社会结构 (Social Structures)] - 2026-01-21

### 进化跃迁：信息素、部落与合作

本阶段通过化学通信、亲缘识别和合作行为引入涌现社会行为。

#### ✨ 新特性

- **信息素系统**：实体留下持久化学踪迹：
    - **食物信息素**：进食时沉积，吸引觅食者
    - **危险信息素**：杀戮地点沉积，警告掠食者存在
    - 信息素随时间衰减（每tick衰减0.5%）
- **部落形成**：基于颜色的亲缘识别：
    - 颜色相近的实体（RGB距离<60）形成部落
    - 同部落成员永不互相攻击
- **领地行为**：实体在出生地附近攻击性提高50%
- **能量分享**：高能量实体可与饥饿邻居分享能量
    - 新增"分享"状态（♣）表示主动分享
- **扩展神经网络**：6输入 → 6隐藏 → 5输出：
    - 新增输入：信息素强度、部落密度
    - 新增输出：分享意图

#### 🛠️ 技术成就

- **信息素网格**：高效网格化信息素存储与衰减
- **Vec神经网络**：数组转Vec以支持serde序列化
- **社交符号**：新增分享符号（♣）和绿色状态颜色

---

## [阶段 10: 生态动力学 (Ecosystem Dynamics)] - 2026-01-21

### 演进飞跃：地形、地理与季节

此阶段通过地形系统和季节循环引入环境异质性，实现涌现式迁徙模式。

#### ✨ 功能特性

- **地形系统**：程序化生成的世界地形，包含独特生态区：
    - **山脉** (▲)：移动速度降低 50%，无食物生成
    - **河流** (≈)：移动速度提升 50%
    - **绿洲** (◊)：食物生成率 ×3，吸引迁徙
- **季节循环**：动态四季系统，影响生态平衡：
    - **春天**：食物 ×1.5，代谢 ×0.8（生长期）
    - **夏天**：食物 ×1.0，代谢 ×1.2（活跃期）
    - **秋天**：食物 ×1.2，代谢 ×1.0（收获期）
    - **冬天**：食物 ×0.5，代谢 ×1.5（生存期）
- **地形感知 AI**：实体根据脚下地形自动调整移动速度
- **地理食物分布**：食物自然聚集在绿洲周围

#### 🛠️ 技术成就

- **噪声生成**：多八度值噪声实现自然地形分布
- **分层渲染**：地形作为背景层绘制在实体之前

---

## [阶段 9: 全知之眼 (The Omniscient Eye)] - 2026-01-21

### 演进飞跃：深度分析与可视化叙事

此阶段引入全面的世界分析系统和叙事机制，让模拟世界栩栩如生。

#### ✨ 功能特性

- **纪元系统 (Era System)**：集成了由种群规模驱动的状态机，叙述世界演进纪元（创世、扩张、黄金时代、衰落等）。
- **名人堂 (Hall of Fame)**：实时排行榜，追踪模拟中适应度最高的前 3 名生物。
- **可视化叙事**：状态感知符号（†♥♦●）和基于生理状态的动态颜色映射。
- **高级分析**：滚动脑熵（香农熵）和平均寿命指标，用于监控生物多样性。
- **种群动态**：双火花线系统，实时可视化种群健康状况与硬件压力对比。

---

## [阶段 8: 顶级掠食者与基因协同 (Apex Predators & Genetic Synergy)] - 2026-01-20

### 演进飞跃：捕食、有性繁殖与数据可移植性

此阶段通过引入捕食者-猎物动态和基因交换机制，提升了模拟的复杂性。

#### ✨ 功能特性

- **进化捕食**：新增第 4 个神经输出"攻击性"，使生物能够捕食其他生物并获得巨大能量收益（80% 转化率）。
- **有性繁殖**：实现基因交叉，允许生物与附近配偶结合神经特征。
- **HexDNA 协议**：稳健的序列化格式，支持通过文本文件导出（`C` 键）和注入（`V` 键）生物。
- **高级感知**：重构感知系统，在多轮世界更新中避免借用检查器冲突。
- **增强编年史**：UI 事件日志现可叙述捕食事件和基因风暴。

---

## [阶段 7: 神圣交互 (Divine Interface)] - 2026-01-20

### 演进飞跃：交互与分类学

此阶段的重点是从被动观察者转变为主动的“数字神明”，引入了干预工具和复杂的物种分类系统。

#### ✨ 功能特性

- **鼠标驱动交互**：启用了完整的终端鼠标支持。用户现在可以点击单个生物来检查其神经状态、血统和特定的遗传特征。
- **程序化命名 engine**：每个生物现在都会根据其基因型分配一个唯一的、程序化生成的名称（例如 *Xylos-Tetra*, *Aether-7*），不再使用原始 UUID，以增强叙事感。
- **实时 UI 编年史**：实现了实时事件日志（“编年史”），叙述重大的演进事件（例如“第 5000 刻的大饥荒”，“传奇英雄 *Zenith* 已陨落”）。
- **神圣干预工具**：
    - **基因浪潮 (Genetic Surge)**：手动触发高变异爆发，强制种群快速适应。
    - **资源投放 (Food Injection)**：交互式放置资源簇，引导种群迁移。
- **基于基因型的物种聚类**：实现了 L2 范数距离算法，根据神经权重相似性将生物分组为“物种”，允许 UI 实时监控生物多样性及不同谱系的兴衰。

#### 🛠️ 技术成就

- **事件驱动的 UI 更新**：优化了事件循环，每帧排空事件队列，确保鼠标交互零延迟。
- **空间哈希查询**：集成了基于网格的空间分区系统，支持实时鼠标拾取并将感官查询复杂度优化至 $O(N \log N)$。

---

## [阶段 6: 沉浸 (Immersion)] - 2026-01-15

### 优化与部署阶段

专注于性能、灵活性和“屏幕保护程序”式的体验。

#### ✨ 功能特性

- **空间哈希优化 (Spatial Hash)**：使用动态空间哈希网格取代了 $O(N^2)$ 的邻居检查，支持在标准硬件上流畅运行 500+ 实体。
- **多模式支持**：
    - **标准模式**：具有完整仪表板的 TUI 界面。
    - **画境模式 (Screensaver)**：极简、无干扰的世界视图。
    - **静默模式 (Headless)**：用于数据挖掘和长期演进研究的高速后台模拟。
- **配置系统**：将所有模拟常量外部化到 `config.toml`，支持热调参。

---

## [阶段 5 & 5.5: 账本与区块链 (The Ledger & Blockchain)]

### 永恒历史与独立分析

确保每一个传奇的生命都被刻在数字穹顶之上。

#### ✨ 功能特性

- **JSONL 事件日志**：将每一次出生、死亡和环境变迁稳健地流式传输到 `logs/live.jsonl`。
- **传奇判定标准**：自动归档满足精英适应度阈值的“传奇生物”。
- **OpenTimestamps 锚定**：会话日志的 SHA-256 哈希被锚定到比特币区块链。
- **独立工具集**：
    - `primordium-ledger-analyzer`：生成详细报告及家谱可视化。
    - `primordium-ledger-verifier`：验证本地日志的完整性。

---

## [阶段 4: 神经觉醒 (Neural Awakening)]

### 向智能的过渡

用感官驱动的神经处理取代随机运动。

#### ✨ 功能特性

- **4x6x3 神经网络**：为每个生物实现多层感知器 (MLP)。
- **感官输入**：食物向量、能量储备、局部拥挤度。
- **实时大脑热图**：实时可视化当前选中生物的突触权重。

---

## [阶段 1-3: 原初与共振 (Genesis & Resonance)]

### 基础与硬件耦合

宇宙的诞生以及代码与硅片的耦合。

#### ✨ 功能特性

- **Ratatui 基础**：建立了高性能的 TUI 框架。
- **代谢能量循环**：复杂的生存系统，动作即能量。
- **硬件耦合气候**：将 CPU/RAM 负载转化为环境压力。
