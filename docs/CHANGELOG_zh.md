# 修订历史 - Primordium (原初之境)

[English](../CHANGELOG.md)

本文件记录了 **Primordium** 项目的所有重大变更。本项目遵循基于阶段的演进式开发周期。

---

## [阶段 21: 环境流动性与灾难 (Environmental Fluidity & Disasters)] - 2026-01-21

### 演进飞跃：时间连贯性与动态危机

数字生态系统获得了“记忆”并面临首次环境大灾难，这要求生物进化出更复杂的生存策略。

#### ✨ 功能特性

- **循环神经网络 (RNN-lite)**: 升级了大脑架构，引入上一个 tick 隐藏层的反馈回路，实现了时间连贯的行为和内部记忆。
- **沙尘暴灾难 (Dust Bowl)**: 引入了动态地形事件。当种群压力过大且处于热浪时，会触发大规模土地肥力损耗和荒芜化。
- **物理障碍**: 增加了不可穿透的 `Wall` (墙壁/岩石) 地形，迫使生物进化出转向和避障能力。
- **局部感知**: 从全局食物知识迁移到真实的“感知半径”（20单位），由专门的 `food_hash` 提供动力。

#### 🛠️ 技术成就

- **O(1) 感知**: 集成了第二个空间哈希 (Spatial Hash) 专门用于资源管理，降低了感官查询复杂度。
- **缓冲池 (Buffer Pooling)**: 在 `World` 结构体中实现了可重用的堆分配，显著降低了并行执行时的内存分配开销。
- **有状态智能**: 在 `Intel` 组件中增加了持久化的 `last_hidden` 状态，支持新的循环大脑架构。
- **物理引擎升级**: 增强了 `handle_movement` 逻辑，支持对不可通行地形的碰撞检测与反弹。

---

## [阶段 20: 认知合成与系统重构 (Cognitive Synthesis & Systemic Refactor)] - 2026-01-21

### 演进飞跃：基于组件的生命与并行智能

模拟经历了自项目启动以来最重大的架构演进，转向了专为极致性能和超大规模扩展设计的模块化组件系统。

#### ✨ 功能特性

- **基于组件的实体 (CBE)**: 生物属性现已逻辑分组为物理 (Physics)、代谢 (Metabolism)、健康 (Health) 和智力 (Intel) 组件，提升了系统隔离度和数据局部性。
- **系统化解耦**: 世界更新循环被拆分为一系列专业化的“系统”（感知、行动、生物、社交），使逻辑更易于扩展和维护。
- **Rayon 驱动的并行化**: 集成了 Rayon 数据并行库，利用多核 CPU 处理沉重的计算任务。
- **高密度扩展**: 针对 5000+ 同时存在的实体进行了优化，支持多线程神经推理。

#### 🛠️ 技术成就

- **并行大脑推理**: 神经网络前向传播现已通过 `.par_iter()` 实现并行处理。
- **系统流水线**: 将 `World::update` 重构为离散阶段，解决了长期存在的“单体代码”技术债务。
- **数据局部性**: 组件分组使模拟每系统仅处理相关数据子集，减少了缓存失效。
- **逻辑等效性**: 在大幅提升吞吐量的同时，实现了与之前版本 100% 的功能等效。

---

## [阶段 19: 昼夜循环 (Circadian Rhythms)] - 2026-01-21

### 演进飞跃：时间维度的引入

数字生态系统现在随昼夜周期波动，影响植物生长及生物的新陈代谢。

#### ✨ 功能特性

- **昼夜周期**: 引入全球时钟（默认 2000 刻），实现白昼与黑夜的交替。
- **光照依赖生长**: 食物生成概率与当前光照强度 (`light_level`) 挂钩。正午生长最快，黑夜几乎停滞。
- **休息代谢**: 生物在夜间进入低功耗模式，静息能量消耗降低 40%。
- **TUI 可视化**: 状态栏实时显示昼夜图标 (☀️/🌙) 及当前时钟进度。

#### 🛠️ 技术成就

- **环境状态推进**: 在世界更新循环中集成了 `Environment::tick` 机制。
- **物理耦合**: 将光照强度和昼夜系数整合进核心代谢算法中。
- **验证**: 新增 `test_light_dependent_food_growth` 集成测试验证光照对生态的影响。

---

... (rest of file)
