# AGENTS_BASE.md

> AI Agent 通用工作指南 - 适用于所有项目的基础规范

## 目录

- [优先级原则](#优先级原则)
- [代码规范](#代码规范)
- [文档要求](#文档要求)
- [测试策略](#测试策略)
- [Git 工作流](#git-工作流)
- [沟通规范](#沟通规范)
- [常见场景处理](#常见场景处理)

---

## 优先级原则

### Vibe Coding 优先级判定

**优先级判定标准:**

- **必要性** - 项目能否正常运行
- **重要性** - 对核心功能的影响程度
- **整体意义** - 对项目长期价值的贡献

**高优先级任务类型:**

- ✅ 新功能实现
- ✅ 核心功能缺陷(bug)修复
- ✅ 影响主要使用流程的问题
- ✅ 用户关键界面展示(UI/CLI 输出)
- ✅ 关键日志、可观测性、诊断信息
- ✅ **核心文档编写与维护**
    - README、快速开始指南
    - 架构设计文档
    - API 文档、接口说明
    - 重要配置说明
    - 故障排查指南
- ✅ 安全漏洞修复
- ✅ 性能瓶颈优化(影响用户体验)

**低优先级任务:**

- ⏸️ 代码格式美化(非功能性)
- ⏸️ 过度优化的重构
- ⏸️ 非关键注释补充
- ⏸️ 可选的语法糖改进
- ⏸️ 边缘情况的过度处理

**判断原则:**
只要某项工作在必要性、重要性或长期价值上**显著影响项目**,即应视为高优先级,优先完成。

### 文档优先级说明

良好的文档是项目可维护性和可用性的关键保障:

- 帮助新用户快速上手
- 减少重复性问题咨询
- 提升团队协作效率
- 降低项目维护成本

**核心文档应与代码同步更新**,当功能变更时,相关文档的更新优先级等同于代码本身。

---

## 代码规范

### 编码原则

1. **可读性优先** - 代码是写给人看的,其次才是机器
2. **简单优于复杂** - 优先选择简单直接的实现
3. **一致性** - 遵循项目现有的代码风格
4. **渐进式改进** - 小步快跑,避免大范围重构

### 命名规范

- **变量/函数**: 使用描述性名称,体现用途
- **类名**: 使用名词
- **常量**: 全大写或项目约定
- **私有成员**: 遵循语言惯例

### 注释原则

- **注释"为什么",而非"是什么"**
- 复杂逻辑必须注释
- 公共 API 必须有文档
- 避免冗余注释

```python
# ❌ BAD - 注释重复代码
# 计算总和
total = sum(numbers)

# ✅ GOOD - 解释为什么
# 使用滑动窗口而非全量扫描,避免内存溢出
result = sliding_window_sum(large_dataset)
```

### 错误处理

- **明确的异常类型** - 不要捕获所有异常
- **有意义的错误信息** - 帮助快速定位问题
- **适当的日志记录** - 关键路径必须有日志
- **优雅降级** - 非核心功能失败不应导致系统崩溃

---

## 文档要求

### 核心文档结构

**必需文档:**

- ✅ `README.md` - 项目概述、快速开始
- ✅ `CONTRIBUTING.md` - 贡献指南
- ✅ `CHANGELOG.md` - 版本变更记录
- ✅ API 文档 - 公共接口说明
- ✅ `ARCHITECTURE.md` - 核心设计决策

**文档更新原则:**

- 代码变更时,**同步更新**相关文档
- 文档优先级等同于代码本身
- 使用示例代码增强可读性
- 保持文档简洁,避免过度细节

### README.md 通用结构

```markdown
# 项目名称
简短描述(一句话)

## 特性
- 核心功能列举

## 快速开始
### 安装
### 基本使用

## 文档
链接到详细文档

## 贡献
如何参与贡献

## 许可证
```

---

## 测试策略

### 测试优先级

1. **核心功能测试** - 主要使用路径必须覆盖
2. **边界条件测试** - 异常输入、空值、极限值
3. **集成测试** - 关键模块间交互
4. **回归测试** - bug 修复后必须添加测试用例

### 测试原则

- **测试应该快速** - 单个测试 < 100ms
- **测试应该独立** - 不依赖执行顺序
- **测试应该可重复** - 多次运行结果一致
- **测试名称应该描述性** - 说明测试内容和预期

### 何时可以跳过测试

- **原型验证阶段** - 快速试错
- **一次性脚本** - 不会被重用
- **明显的 getter/setter** - 无业务逻辑
- **但:** 核心功能、公共 API、bug 修复**必须有测试**

---

## Git 工作流

### Commit 规范

使用 [Conventional Commits](https://www.conventionalcommits.org/) 格式:

```txt
<type>(<scope>): <subject>

<body>

<footer>
```

**类型(type):**

- `feat`: 新功能
- `fix`: bug 修复
- `docs`: 文档变更
- `style`: 代码格式(不影响功能)
- `refactor`: 重构(既非新功能也非 bug 修复)
- `perf`: 性能优化
- `test`: 测试相关
- `chore`: 构建/工具配置

**示例:**

```bash
feat(auth): add OAuth2 login support

Implement OAuth2 authentication flow with Google provider.
Includes token refresh and session management.

Closes #123
```

### 分支策略

- `main/master` - 生产就绪代码
- `develop` - 开发主分支
- `feature/*` - 功能分支
- `fix/*` - bug 修复分支
- `hotfix/*` - 紧急修复

### PR/MR 基本规范

- **标题清晰** - 简要说明变更内容
- **描述完整** - 为什么改、怎么改、影响范围
- **关联 Issue** - 使用 `Closes #123`
- **自我审查** - 提交前检查 diff
- **小而美** - 单个 PR 聚焦一个主题

---

## 沟通规范

### 与开发者沟通

1. **先理解需求** - 不确定时主动询问
2. **提供选项** - 给出多种方案及利弊
3. **解释决策** - 说明技术选择的原因
4. **承认局限** - 不清楚时坦诚说明
5. **建设性反馈** - 指出问题时提供解决方向

### 提问模板

```markdown
## 当前情况
[描述现状]

## 遇到的问题
[具体问题]

## 可能的方案
1. 方案A - [优点/缺点]
2. 方案B - [优点/缺点]

## 建议
[推荐方案及理由]

## 需要确认
- [ ] 是否符合预期?
- [ ] 是否有其他考虑?
```

---

## 常见场景处理

### 遗留代码处理

- **先理解,再重构** - 不要轻易删除看不懂的代码
- **增量改进** - 每次改进一小部分
- **添加测试** - 重构前先加测试保护
- **保留注释** - 说明历史原因

### 性能优化

1. **先测量,再优化** - 使用 profiler 找到瓶颈
2. **优化热点路径** - 80/20 原则
3. **权衡可读性** - 过度优化损害维护性
4. **记录性能指标** - 对比优化前后

### 依赖管理

- **最小化依赖** - 每个依赖都是负担
- **版本锁定** - 生产环境使用精确版本
- **定期更新** - 安全补丁及时更新
- **评估必要性** - 能自己实现的简单功能不引入依赖

### 安全考虑

- ⚠️ **不要硬编码密钥** - 使用环境变量或密钥管理
- ⚠️ **验证所有输入** - 永远不信任用户输入
- ⚠️ **最小权限原则** - 只给必需的权限
- ⚠️ **敏感数据加密** - 传输和存储都要加密
- ⚠️ **审计日志** - 记录关键操作

---

**保持简单、清晰、可维护。**
